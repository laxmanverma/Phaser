!function(t){"use strict";t.Plugin.KineticScrolling=function(i,e){t.Plugin.call(this,i,e),this.pointerId=null,this.dragging=!1,this.pressedDown=!1,this.timestamp=0,this.callbackID=0,this.targetX=0,this.targetY=0,this.autoScrollX=!1,this.autoScrollY=!1,this.startX=0,this.startY=0,this.velocityX=0,this.velocityY=0,this.amplitudeX=0,this.amplitudeY=0,this.directionWheel=0,this.velocityWheelX=0,this.velocityWheelY=0,this.thresholdOfTapTime=100,this.thresholdOfTapDistance=10,this.thresholdReached=!1,this.clickHelperActiveObjects=[],this.settings={kineticMovement:!0,timeConstantScroll:325,horizontalScroll:!0,verticalScroll:!1,horizontalWheel:!0,verticalWheel:!1,deltaWheel:40,onUpdate:null,button:""}},t.Plugin.KineticScrolling.prototype=Object.create(t.Plugin.prototype),t.Plugin.KineticScrolling.prototype.constructor=t.Plugin.KineticScrolling,t.Plugin.KineticScrolling.prototype.configure=function(t){if(t)for(var i in t)this.settings.hasOwnProperty(i)&&(this.settings[i]=t[i])},t.Plugin.KineticScrolling.prototype.start=function(){this.game.input.onDown.add(this.beginMove,this),this.callbackID=this.game.input.addMoveCallback(this.moveCamera,this),this.game.input.onUp.add(this.endMove,this),this.game.input.mouse.mouseWheelCallback=this.mouseWheel.bind(this)},t.Plugin.KineticScrolling.prototype.beginMove=function(i){this.settings.button&&i.button!==t.Mouse[this.settings.button]||(this.pointerId=i.id,this.startX=this.game.input.x,this.startY=this.game.input.y,this.screenX=i.screenX,this.screenY=i.screenY,this.pressedDown=!0,this.thresholdReached=!1,this.timestamp=Date.now(),this.beginTime=this.timestamp,this.velocityY=this.amplitudeY=this.velocityX=this.amplitudeX=0)},t.Plugin.KineticScrolling.prototype.moveCamera=function(t,i,e){if(clearTimeout(this.clearMovementTimer),this.pressedDown&&this.pointerId===t.id){this.now=Date.now();var s=this.now-this.timestamp;this.timestamp=this.now;var l=0,h=0;if(!(this.isTap()&&Math.abs(t.screenY-this.screenY)<this.thresholdOfTapDistance&&Math.abs(t.screenX-this.screenX)<this.thresholdOfTapDistance)){if(!this.thresholdReached)return this.thresholdReached=!0,this.startX=i,this.startY=e,void this.cancelClickEventHelpers();if(this.settings.horizontalScroll&&(l=i-this.startX,0!==l&&(this.dragging=!0),this.startX=i,this.velocityX=.8*(1e3*l/(1+s))+.2*this.velocityX,this.game.camera.x-=l),this.settings.verticalScroll&&(h=e-this.startY,0!==h&&(this.dragging=!0),this.startY=e,this.velocityY=.8*(1e3*h/(1+s))+.2*this.velocityY,this.game.camera.y-=h),"function"==typeof this.settings.onUpdate){var n=0;this.canCameraMoveX()&&(n=l);var c=0;this.canCameraMoveY()&&(c=h),this.settings.onUpdate(n,c)}this.clearMovementTimer=setTimeout(function(){this.velocityX=0,this.velocityY=0}.bind(this),20)}}},t.Plugin.KineticScrolling.prototype.isTap=function(){return this.now-this.beginTime<this.thresholdOfTapTime},t.Plugin.KineticScrolling.prototype.canCameraMoveX=function(){return this.game.camera.x>0&&this.game.camera.x+this.game.camera.width<this.game.camera.bounds.right},t.Plugin.KineticScrolling.prototype.canCameraMoveY=function(){return this.game.camera.y>0&&this.game.camera.y+this.game.camera.height<this.game.camera.bounds.height},t.Plugin.KineticScrolling.prototype.addClickEvents=function(t,i){if(t.kineticScrollingClickHelpers)for(var e in i)i.hasOwnProperty(e)&&(t.kineticScrollingClickHelpers[e]=i[e]);else t.kineticScrollingClickHelpers=i,t.inputEnabled=!0,t.kineticScrollingClickHelpers.inputIsDown=!1,t.events.onInputDown.add(function(){t.kineticScrollingClickHelpers.downTimer=setTimeout(function(){t.kineticScrollingClickHelpers.downTimer=null,this.thresholdReached||(this.clickHelperActiveObjects.push(t),t.kineticScrollingClickHelpers.inputIsDown=!0,t.kineticScrollingClickHelpers.down&&t.kineticScrollingClickHelpers.down(t))}.bind(this),this.thresholdOfTapTime+10)},this),t.events.onInputUp.add(function(){this.clickHelperActiveObjects.splice(this.clickHelperActiveObjects.indexOf(t)),t.kineticScrollingClickHelpers.inputIsDown?(t.kineticScrollingClickHelpers.up&&t.kineticScrollingClickHelpers.up(t),this.isTap()&&t.kineticScrollingClickHelpers.click&&t.kineticScrollingClickHelpers.click(t),t.kineticScrollingClickHelpers.inputIsDown=!1):t.kineticScrollingClickHelpers.downTimer&&!this.thresholdReached&&(clearTimeout(t.kineticScrollingClickHelpers.downTimer),t.kineticScrollingClickHelpers.down&&t.kineticScrollingClickHelpers.down(t),t.kineticScrollingClickHelpers.up&&t.kineticScrollingClickHelpers.up(t),t.kineticScrollingClickHelpers.click&&t.kineticScrollingClickHelpers.click(t))}.bind(this))},t.Plugin.KineticScrolling.prototype.cancelClickEventHelpers=function(){this.clickHelperActiveObjects.forEach(function(t){var i=t.kineticScrollingClickHelpers.inputIsDown;t.kineticScrollingClickHelpers.inputIsDown=!1,i&&t.kineticScrollingClickHelpers.up&&t.kineticScrollingClickHelpers.up()})},t.Plugin.KineticScrolling.prototype.endMove=function(){clearTimeout(this.clearMovementTimer),this.pointerId=null,this.pressedDown=!1,this.autoScrollX=!1,this.autoScrollY=!1,this.settings.kineticMovement&&(this.now=Date.now(),this.game.input.activePointer.withinGame&&((this.velocityX>10||this.velocityX<-10)&&(this.amplitudeX=.8*this.velocityX,this.targetX=Math.round(this.game.camera.x-this.amplitudeX),this.autoScrollX=!0),(this.velocityY>10||this.velocityY<-10)&&(this.amplitudeY=.8*this.velocityY,this.targetY=Math.round(this.game.camera.y-this.amplitudeY),this.autoScrollY=!0)),this.game.input.activePointer.withinGame||(this.velocityWheelXAbs=Math.abs(this.velocityWheelX),this.velocityWheelYAbs=Math.abs(this.velocityWheelY),this.settings.horizontalScroll&&(this.velocityWheelXAbs<.1||!this.game.input.activePointer.withinGame)&&(this.autoScrollX=!0),this.settings.verticalScroll&&(this.velocityWheelYAbs<.1||!this.game.input.activePointer.withinGame)&&(this.autoScrollY=!0)))},t.Plugin.KineticScrolling.prototype.update=function(){this.elapsed=Date.now()-this.timestamp,this.velocityWheelXAbs=Math.abs(this.velocityWheelX),this.velocityWheelYAbs=Math.abs(this.velocityWheelY);var t=0;this.autoScrollX&&0!=this.amplitudeX&&(t=-this.amplitudeX*Math.exp(-this.elapsed/this.settings.timeConstantScroll),this.canCameraMoveX()&&(t>.5||t<-.5)?this.game.camera.x=this.targetX-t:(this.autoScrollX=!1,this.game.camera.x=this.targetX)),this.autoScrollY&&0!=this.amplitudeY&&(t=-this.amplitudeY*Math.exp(-this.elapsed/this.settings.timeConstantScroll),this.canCameraMoveY()&&(t>.5||t<-.5)?this.game.camera.y=this.targetY-t:(this.autoScrollY=!1,this.game.camera.y=this.targetY)),this.autoScrollX||this.autoScrollY||(this.dragging=!1),this.settings.horizontalWheel&&this.velocityWheelXAbs>.1&&(this.dragging=!0,this.amplitudeX=0,this.autoScrollX=!1,this.game.camera.x-=this.velocityWheelX,this.velocityWheelX*=.95),this.settings.verticalWheel&&this.velocityWheelYAbs>.1&&(this.dragging=!0,this.autoScrollY=!1,this.game.camera.y-=this.velocityWheelY,this.velocityWheelY*=.95)},t.Plugin.KineticScrolling.prototype.mouseWheel=function(t){if(this.settings.horizontalWheel||this.settings.verticalWheel){t.preventDefault();var i=120*this.game.input.mouse.wheelDelta/this.settings.deltaWheel;if(this.directionWheel!=this.game.input.mouse.wheelDelta&&(this.velocityWheelX=0,this.velocityWheelY=0,this.directionWheel=this.game.input.mouse.wheelDelta),this.settings.horizontalWheel&&(this.autoScrollX=!1,this.velocityWheelX+=i,"function"==typeof this.settings.onUpdate)){var e=0;this.game.camera.x>0&&this.game.camera.x+this.game.camera.width<this.game.camera.bounds.width&&(e=i),this.settings.onUpdate(e,0)}if(this.settings.verticalWheel&&(this.autoScrollY=!1,this.velocityWheelY+=i,"function"==typeof this.settings.onUpdate)){var s=0;this.game.camera.y>0&&this.game.camera.y+this.game.camera.height<this.game.camera.bounds.height&&(s=i),this.settings.onUpdate(0,s)}}},t.Plugin.KineticScrolling.prototype.stop=function(){this.pressedDown=!1,this.game.input.onDown.remove(this.beginMove,this),this.callbackID?this.game.input.deleteMoveCallback(this.callbackID):this.game.input.deleteMoveCallback(this.moveCamera,this),this.game.input.onUp.remove(this.endMove,this),this.game.input.mouse.mouseWheelCallback=null,this.clickHelperActiveObjects.length=0}}(Phaser);